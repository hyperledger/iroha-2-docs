import{_ as s,c as i,o as e,V as a}from"./chunks/framework.B6c1f-8R.js";const g=JSON.parse('{"title":"Permissions","description":"","frontmatter":{},"headers":[],"relativePath":"blockchain/permissions.md","filePath":"blockchain/permissions.md","lastUpdated":1727363525000}'),t={name:"blockchain/permissions.md"},n=a(`<h1 id="permissions" tabindex="-1">Permissions <a class="header-anchor" href="#permissions" aria-label="Permalink to &quot;Permissions&quot;">​</a></h1><p>Accounts need permission tokens for various actions on a blockchain, e.g. to mint or burn assets.</p><p>There is a difference between a public and a private blockchain in terms of permissions granted to users. In a public blockchain, most accounts have the same set of permissions. In a private blockchain, most accounts are assumed not to be able to do anything outside of their own account or domain unless explicitly granted said permission.</p><p>Having a permission to do something means having a <code>PermissionToken</code> to do so. There are two ways for users to receive permission tokens: they can be granted directly or as a part of a <a href="#permission-groups-roles"><code>Role</code></a> (a set of permission tokens). Permissions are granted via <code>Grant</code> special instruction. Permission tokens and roles do not expire, they can only be removed using <code>Revoke</code> instruction.</p><h2 id="permission-tokens" tabindex="-1">Permission Tokens <a class="header-anchor" href="#permission-tokens" aria-label="Permalink to &quot;Permission Tokens&quot;">​</a></h2><p>Permission token definitions have parameters. When a new permission token is registered, the names of the parameters and their types are checked against their names and types in the token definition. The token registration fails if there are too few parameters, if the parameter types don&#39;t match the definition, or parameters with unrecognised names.</p><p>Here are some examples of parameters used for various permission tokens:</p><ul><li><p>A token that grants permission to change the values associated to keys in a <code>Store</code> asset needs the <code>asset_definition_id</code> parameter of type <code>Id</code>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">     &quot;asset_definition_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Id&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>By contrast, the permission token that grants the permission to set keys to values in user <em>metadata</em> needs the <code>account_id</code> parameter of type <code>Id</code>:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;account_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Id&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>The permission token that grants the permission to transfer assets only a fixed number of times per some time period, needs these two parameters:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;params&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;count&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;U32&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;period&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;U128&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Where the <code>period</code> is specified as a standard Duration since the UNIX epoch in milliseconds (more details about <a href="https://doc.rust-lang.org/std/time/struct.SystemTime.html" target="_blank" rel="noreferrer">time in Rust</a>).</p></li></ul><h3 id="pre-configured-permission-tokens" tabindex="-1">Pre-configured Permission Tokens <a class="header-anchor" href="#pre-configured-permission-tokens" aria-label="Permalink to &quot;Pre-configured Permission Tokens&quot;">​</a></h3><p>You can find the list of pre-configured permission tokens in the <a href="/iroha-2-docs/reference/permissions.html">Reference</a> chapter.</p><h2 id="permission-groups-roles" tabindex="-1">Permission Groups (Roles) <a class="header-anchor" href="#permission-groups-roles" aria-label="Permalink to &quot;Permission Groups (Roles)&quot;">​</a></h2><p>A set of permissions is called a <strong>role</strong>. Similarly to permission tokens, roles can be granted using the <code>Grant</code> instruction and revoked using the <code>Revoke</code> instruction.</p><p>Before granting a role to an account, the role should be registered first.</p><h3 id="register-a-new-role" tabindex="-1">Register a new role <a class="header-anchor" href="#register-a-new-role" aria-label="Permalink to &quot;Register a new role&quot;">​</a></h3><p>Let&#39;s register a new role that, when granted, will allow another account access to the <a href="/iroha-2-docs/blockchain/metadata.html">metadata</a> in Mouse&#39;s account:</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> role_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RoleId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from_str</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ACCESS_TO_MOUSE_METADATA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> role </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> iroha_data_model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">role</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Role</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(role_id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_permission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CanSetKeyValueInUserMetadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mouse_id))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add_permission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">CanRemoveKeyValueInUserMetadata</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mouse_id));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> register_role </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RegisterBox</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(role);</span></span></code></pre></div><h3 id="grant-a-role" tabindex="-1">Grant a role <a class="header-anchor" href="#grant-a-role" aria-label="Permalink to &quot;Grant a role&quot;">​</a></h3><p>After the role is registered, Mouse can grant it to Alice:</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> grant_role </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GrantBox</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(role_id, alice_id);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> grant_role_tx </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    Transaction</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mouse_id, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vec!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[grant_role</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">into</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mouse_key_pair)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h2 id="permission-validators" tabindex="-1">Permission Validators <a class="header-anchor" href="#permission-validators" aria-label="Permalink to &quot;Permission Validators&quot;">​</a></h2><p>Permissions exist so that only those accounts that have a required permission token to perform a certain action could do so.</p><p>The <code>Judge</code> trait is used to check permissions. The <code>Judge</code> decides whether a certain operation (instruction, query, or expression) could be performed based on the verdicts of multiple validators.</p><p>Each validator returns one of the following verdicts: <code>Deny</code> (with the exact reason to deny an operation), <code>Skip</code> (if an operation is not supported or has no meaning in a given context), or <code>Allow</code>.</p><p>There are several implementations of the <code>Judge</code> trait in Iroha 2, such as:</p><table><thead><tr><th>Judge</th><th>Description</th></tr></thead><tbody><tr><td><code>AtLeastOneAllow</code></td><td>The judge that succeeds only if there is at least one <code>Allow</code> verdict. The execution is stopped once there is a first <code>Allow</code> verdict.</td></tr><tr><td><code>NoDenies</code></td><td>The judge that succeeds only if there is no <code>Deny</code> verdict. All validators are checked.</td></tr><tr><td><code>NoDeniesAndAtLeastOneAllow</code></td><td>The judge that succeeds only if there is no <code>Deny</code> verdict and at least one <code>Allow</code> verdict. The execution is stopped once there is a <code>Deny</code> verdict or all validators were checked.</td></tr><tr><td><code>AllowAll</code></td><td>For tests and simple cases. All operations are allowed to be executed for all possible values.</td></tr><tr><td><code>DenyAll</code></td><td>For tests and simple cases. All operations are disallowed to be executed for all possible for all possible values.</td></tr></tbody></table><p>You can also build a custom permission validator by combining multiple validators, all of which should be of the same type (for checking instructions, queries, or expressions).</p><h3 id="runtime-validators" tabindex="-1">Runtime Validators <a class="header-anchor" href="#runtime-validators" aria-label="Permalink to &quot;Runtime Validators&quot;">​</a></h3><p>Currently Iroha 2 has only built-in validators. In the future, built-in validators will be completely replaced with <strong>runtime validators</strong> that use WASM.</p><p>The <strong>chain</strong> of runtime validators is used to validate operations that require permissions. It works similarly to the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern" target="_blank" rel="noreferrer"><code>Chain of responsibility</code></a>.</p><p>All runtime validators return <strong>validation verdict</strong>. By default, all operations are considered <strong>valid</strong> unless proven otherwise. Validators check whether or not an operation is not allowed: each validator either allows an operation and passes it to the following validator, or denies the operation. The validation stops at the first <code>Deny</code> verdict.</p><h2 id="supported-queries" tabindex="-1">Supported Queries <a class="header-anchor" href="#supported-queries" aria-label="Permalink to &quot;Supported Queries&quot;">​</a></h2><p>Permission tokens and roles can be queried.</p><p>Queries for roles:</p><ul><li><a href="/iroha-2-docs/reference/queries.html#findallroles"><code>FindAllRoles</code></a></li><li><a href="/iroha-2-docs/reference/queries.html#findallroleids"><code>FindAllRoleIds</code></a></li><li><a href="/iroha-2-docs/reference/queries.html#findrolebyroleid"><code>FindRoleByRoleId</code></a></li><li><a href="/iroha-2-docs/reference/queries.html#findrolesbyaccountid"><code>FindRolesByAccountId</code></a></li></ul><p>Queries for permission tokens:</p><ul><li><a href="/iroha-2-docs/reference/queries.html#findallpermissiontokendefinitions"><code>FindAllPermissionTokenDefinitions</code></a></li><li><a href="/iroha-2-docs/reference/queries.html#findpermissiontokensbyaccountid"><code>FindPermissionTokensByAccountId</code></a></li></ul>`,36),o=[n];function r(l,h,d,p,k,c){return e(),i("div",null,o)}const m=s(t,[["render",r]]);export{g as __pageData,m as default};
